# Copyright (c) 2015 The Chromium Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

import chromiumos_board_config

from common.cros_chromite import SlaveType

# Use the SlaveAlloctor declared in 'board_config'.
sa = chromiumos_board_config.slave_allocator
sa.LoadState(enforce=False)

# Baremetal slaves (e.g., build123-m2)
sa.AddPool(SlaveType.BAREMETAL, *('build%s-m2' % (number,) for number in (
    84, 85, 86, 87, 89, 90, 91, 92, 93, 94, 94, 112, 118, 141, 162, 174, 182,
    203, 263, 323
)))

for board_config in chromiumos_board_config.builder_configs.itervalues():
  name = board_config.config.name
  sa.Join(
      name,
      sa.Alloc(
          'builder',
          pools=[SlaveType.BAREMETAL],
          exclusive=False,
          subtype=name))

def GenSlave(hostname, config_names):
  return {
      'master': 'ChromiumOS',
      'builder': [chromiumos_board_config.builder_configs[c].builder_name
                  for c in config_names],
      'hostname': str(hostname),
      'os': 'linux',
      'version': 'precise',
  }

slaves = []
slave_map = sa.GetSlaveMap()
for hostname, entry in slave_map.entries.iteritems():
  slaves.append(GenSlave(hostname, entry.keys))
